function [ret,x0,str,ts,xts]=stimlib(t,x,u,flag);%STIMLIB	is the M-file description of the SIMULINK system named STIMLIB.%	The block-diagram can be displayed by typing: STIMLIB.%%	SYS=STIMLIB(T,X,U,FLAG) returns depending on FLAG certain%	system values given time point, T, current state vector, X,%	and input vector, U.%	FLAG is used to indicate the type of output to be returned in SYS.%%	Setting FLAG=1 causes STIMLIB to return state derivatives, FLAG=2%	discrete states, FLAG=3 system outputs and FLAG=4 next sample%	time. For more information and other options see SFUNC.%%	Calling STIMLIB with a FLAG of zero:%	[SIZES]=STIMLIB([],[],[],0),  returns a vector, SIZES, which%	contains the sizes of the state vector and other parameters.%		SIZES(1) number of states%		SIZES(2) number of discrete states%		SIZES(3) number of outputs%		SIZES(4) number of inputs%		SIZES(5) number of roots (currently unsupported)%		SIZES(6) direct feedthrough flag%		SIZES(7) number of sample times%%	For the definition of other parameters in SIZES, see SFUNC.%	See also, TRIM, LINMOD, LINSIM, EULER, RK23, RK45, ADAMS, GEAR.% Note: This M-file is only used for saving graphical information;%       after the model is loaded into memory an internal model%       representation is used.% the system will take on the name of this mfile:sys = mfilename;new_system(sys)simver(1.3)if (0 == (nargin + nargout))     set_param(sys,'Location',[100,100,456,351])     open_system(sys)end;set_param(sys,'algorithm',     'RK-45')set_param(sys,'Start time',    '0.0')set_param(sys,'Stop time',     '999999')set_param(sys,'Min step size', '0.0001')set_param(sys,'Max step size', '10')set_param(sys,'Relative error','1e-3')set_param(sys,'Return vars',   '')add_block('built-in/Note',[sys,'/','Stim Lib'])set_param([sys,'/','Stim Lib'],...		'Font Weight','bold',...		'Font Size',12,...		'position',[100,16,105,21])add_block('built-in/From Workspace',[sys,'/',['Ramp Step',13,'Ramp']])set_param([sys,'/',['Ramp Step',13,'Ramp']],...		'matl_expr','[0, t_on, t_on, dur; initval, (t_on*slope)+initval, (t_on*slope)+(step+initval), (dur*slope)+(step+initval) ]''',...		'Mask Display','Ramp Step\nRamp')set_param([sys,'/',['Ramp Step',13,'Ramp']],...		'Mask Dialogue','Ramp Step Ramp|Initial value|Time of step|Size of step|Ramp duration|Ramp slope',...		'Mask Translate','initval = @1; t_on = @2; step = @3; dur = @4; slope = @5;')set_param([sys,'/',['Ramp Step',13,'Ramp']],...		'Mask Entries','-30\/1.5\/-1\/5\/20\/',...		'position',[120,138,190,172])add_block('built-in/From Workspace',[sys,'/','Rashbass'])set_param([sys,'/','Rashbass'],...		'matl_expr','[0, t_on, t_on, t_ramp+t_on; initval, initval, step, (speed*t_ramp)+step]''',...		'Mask Display','Rashbass')set_param([sys,'/','Rashbass'],...		'Mask Dialogue','Rashbass|Initial value|Time of step|Size of step|Ramp duration|Ramp slope',...		'Mask Translate','initval = @1; t_on = @2; step = @3; t_ramp = @4; speed = @5;')set_param([sys,'/','Rashbass'],...		'Mask Entries','0\/0.5\/-2\/10\/5\/',...		'position',[10,138,75,172])add_block('built-in/From Workspace',[sys,'/','Pulse 2'])set_param([sys,'/','Pulse 2'],...		'matl_expr','[0, t_on, t_on, t_on+dur,t_on+dur 5; 0, 0,peakval,peakval,0,0]''',...		'Mask Display','Pulse2',...		'Mask Dialogue','Pulse|Peak value|Time of step|Step duration')set_param([sys,'/','Pulse 2'],...		'Mask Translate','peakval = @1; t_on = @2; dur = @3; ',...		'Mask Entries','1\/0\/1\/',...		'position',[185,61,235,99])add_block('built-in/From Workspace',[sys,'/','pulse step'])set_param([sys,'/','pulse step'],...		'matl_expr','[0, t_on, t_on+.001, t_on+dur,t_on+dur+.001 500000; 0, 0,peakval,peakval,0,0]''',...		'Mask Display','Pulse',...		'Mask Dialogue','Pulse|Peak value|Time of step|Step duration')set_param([sys,'/','pulse step'],...		'Mask Translate','peakval = @1; t_on = @2; dur = @3; ',...		'Mask Entries','5\/0\/.02\/',...		'position',[20,63,65,97])%     Subsystem  'Pulse A'.new_system([sys,'/','Pulse A'])set_param([sys,'/','Pulse A'],'Location',[150,112,441,287])add_block('built-in/Outport',[sys,'/','Pulse A/out'])set_param([sys,'/','Pulse A/out'],...		'position',[185,70,205,90])add_block('built-in/Step Fcn',[sys,'/','Pulse A/Step Input'])set_param([sys,'/','Pulse A/Step Input'],...		'hide name',0,...		'Time','offsetTime',...		'After','peak',...		'position',[80,85,100,105])add_block('built-in/Sum',[sys,'/','Pulse A/Sum'])set_param([sys,'/','Pulse A/Sum'],...		'hide name',0,...		'inputs','+-',...		'position',[135,69,155,91])add_block('built-in/Step Fcn',[sys,'/','Pulse A/Step Input1'])set_param([sys,'/','Pulse A/Step Input1'],...		'hide name',0,...		'Time','onsetTime',...		'After','peak',...		'position',[80,55,100,75])add_line([sys,'/','Pulse A'],[160,80;180,80])add_line([sys,'/','Pulse A'],[105,65;115,65;115,75;130,75])add_line([sys,'/','Pulse A'],[105,95;115,95;115,85;130,85])set_param([sys,'/','Pulse A'],...		'Mask Display','pulse',...		'Mask Dialogue','Single Pulse|Time of onset:|Peak value:|Time of offset:',...		'Mask Translate','onsetTime = @1; peak = @2; offsetTime = @3;',...		'Mask Entries','0\/1\/2\/')%     Finished composite block 'Pulse A'.set_param([sys,'/','Pulse A'],...		'position',[105,62,160,98])add_block('built-in/From Workspace',[sys,'/','double pulse1'])set_param([sys,'/','double pulse1'],...		'hide name',0,...		'matl_expr','[ t1, t1, t1+d1, t1+d1, t1+d1+ipd, t1+d1+ipd, t1+d1+ipd+d2, t1+d1+ipd+d2, 10000; 0, p1, p1, 0, 0, p2, p2, 0, 0 ]''',...		'Mask Display','Double\nPulse3')set_param([sys,'/','double pulse1'],...		'Mask Dialogue','Double Pulse|Pulse 1 Magnitude|Time of Pulse 1 Onset|Pulse 1 Duration|Interpulse Delay|Pulse 2 Magnitude|Pulse 2 Duration')set_param([sys,'/','double pulse1'],...		'Mask Translate','p1=@1; t1=@2; d1=@3; ipd=@4; p2=@5; d2=@6;',...		'Mask Entries','goal\/0.01\/stoptime\/0\/0\/0\/',...		'position',[270,173,325,207])add_block('built-in/From Workspace',[sys,'/','double pulse3'])set_param([sys,'/','double pulse3'],...		'hide name',0,...		'matl_expr','[0, t1, t1, t1+d1, t1+d1, t1+d1+ipd, t1+d1+ipd, t1+d1+ipd+d2, t1+d1+ipd+d2, 10000; 0, 0, p1, p1, 0, 0, p2, p2, 0, 0 ]''',...		'Mask Display','Double\nPulse2')set_param([sys,'/','double pulse3'],...		'Mask Dialogue','Double Pulse|Pulse 1 Magnitude|Time of Pulse 1 Onset|Pulse 1 Duration|Interpulse Delay|Pulse 2 Magnitude|Pulse 2 Duration')set_param([sys,'/','double pulse3'],...		'Mask Translate','p1=@1; t1=@2; d1=@3; ipd=@4; p2=@5; d2=@6;',...		'Mask Entries','goal\/0\/stoptime\/0\/0\/0\/',...		'position',[270,113,325,147])add_block('built-in/From Workspace',[sys,'/','double pulse4'])set_param([sys,'/','double pulse4'],...		'hide name',0,...		'matl_expr','[0, t1, t1+.001, t1+d1, t1+d1+.001, t1+d1+.001+ipd, t1+d1+.001+ipd, t1+d1+.001+ipd+d2, t1+d1+.001+ipd+d2, 10000; 0, 0, p1, p1, 0, 0, p2, p2, 0, 0 ]''')set_param([sys,'/','double pulse4'],...		'Mask Display','Double\nPulse',...		'Mask Dialogue','Double Pulse|Pulse 1 Magnitude|Time of Pulse 1 Onset|Pulse 1 Duration|Interpulse Delay|Pulse 2 Magnitude|Pulse 2 Duration')set_param([sys,'/','double pulse4'],...		'Mask Translate','p1=@1; t1=@2; d1=@3; ipd=@4; p2=@5; d2=@6;',...		'Mask Entries','goal\/0\/stoptime\/0\/0\/0\/',...		'position',[270,58,325,92])drawnow% Return any arguments.if (nargin | nargout)	% Must use feval here to access system in memory	if (nargin > 3)		if (flag == 0)			eval(['[ret,x0,str,ts,xts]=',sys,'(t,x,u,flag);'])		else			eval(['ret =', sys,'(t,x,u,flag);'])		end	else		[ret,x0,str,ts,xts] = feval(sys);	endelse	drawnow % Flash up the model and execute load callbackend
% edfbiasgen.m: generate an adjust bias file for data converted from EDF files.% Written by:  Jonathan Jacobs%              December 2016 - January 2017 (last mod: 01/23/17)function edfbiasgen(fname,pn,sf,numrecs)biasfile = ['adjbias_' fname '.txt'];cd(pn)afilelist=dir('adjbias_*');for i=1:length(afilelist)   if strcmpi( afilelist(i).name, biasfile )      disp( ['** The file ' biasfile ' already exists.'])      disp(  '** Do you want to replace it (y/n)?')      yorn=input('** -> ','s');      if strcmpi(yorn,'y')         delete(biasfile)         disp(['** ' biasfile ' will be replaced.'])         disp(' ')         break      else         return      end   endend[comp, ~] = computer;if strcmp( comp(1),'M' )   CR = 13;else   CR = [13 10];endCR = char(CR);oldpath = pwd;mstr = 'VID'; exten = '.bin'; %format = 'B';fstr = 'RAWBIN'; orgstr = 'Contiguous';h_adjstr = '  0   [15 20 25 30] 1 1 1 1  [-15 -20 -25 -30] 1 1 1 1';v_adjstr = '  0   [10]  1  [-10]  1';chan_count = 4;chanstr = ['lh';'rh';'lv';'rv'];sampfstr = num2str(sf(1));%chop off any trailing underscore for now. We will add it back when neededstripped_uscore = 0;subjstr=fname;if subjstr(length(subjstr))=='_'   subjstr = subjstr(1:end-1);   stripped_uscore = 1;endfid = fopen(['adjbias_' fname,'.txt'],'wt');if fid == -1, disp('Yikes! Could not create that file!'); keyboard; enda = exist('time','file');if a == 2   dstr = [' on ' time('d',1,24,1)];   tstr = [' at ' time('t',1,24,1)];else   dstr = '';   tstr = '';endcommentstr1 = '% automagically generated by "biasgen"';commentstr2 = ['%' dstr tstr];fwrite(fid, [commentstr1 CR]);fwrite(fid, [commentstr2 CR]);fwrite(fid, CR);% now we can add the underscore back if needed.for i = 1:numrecs      if (isdigit(subjstr(end)) || stripped_uscore == 1) && numrecs>1      subjstr = [subjstr '_' num2str(i)];   end      firstline = [subjstr  exten '  ' num2str(chan_count) '  '...      mstr '  ' fstr ' ' sampfstr ' ' orgstr  CR];   fwrite(fid,firstline);   for j = 1:chan_count      if strcmpi( chanstr(j,2), 'v' )         adjstr = v_adjstr;      else         adjstr = h_adjstr;      end      nextline = [chanstr(j,1:2) '  ' adjstr CR];  % used to place 'sampfstr' here.      fwrite(fid, nextline);   end   fwrite(fid, CR);endfclose(fid);disp(['Adjust bias file written as ' biasfile]);disp('P.S.: Don''t panic if you think you messed up.')disp('You can manually edit the bias file using any text editor,')disp('so you can tweak any values afterwards.')disp(' ')try   cd(oldpath)catch   end
% whenslip.m:  find when the velocity falls just inside the % slip velocity limit of 4.0 deg/sec.% written by: Jonathan Jacobs%             December 1995 - January 1997  (last mod: 01/24/97)if ~exist( 'sacp_on_mat' )   disp( 'You need to run "pickdata" first.' )   returnend[nRows, nCols] = size(sacv_on_mat);% initialize crossing arrayssampl_cross = NaN*ones(nRows, nCols);time_cross  = NaN*ones(nRows, nCols);avg_cross   = [];med_cross   = [];big_hist    = [];cutoff_time = input('Go back up to how many milliseconds? ');%cutoff_samp = cutoff_time*samp_freq/1000;  % cutoff_time ms before saccadevelslipradius = 4.0;% process each selected file's sacv_on_matfor k=1:nCols   cutoff_samp = cutoff_time*samp_f_mat(k)/1000;        % ms before saccade   list_len(k) = length(find(sacv_on_mat(:,k)<100000));   sacv_on = sacv_on_mat( 1:list_len(k), k );  % strip NaNs   % do each point in the vel-derived saccade-on list   for j=1:list_len(k)       offset(j) = 0;       while abs(vel( sacv_on(j) - offset(j), k )) > velslipradius          offset(j) = offset(j) + 1;          if ( offset(j) > cutoff_samp )  % didn't get inside slip rad             offset(j) = NaN;             % so NaN out this point             disp(['Didn''t fit in radius by ' num2str(cutoff_time)...                   ' msec: saccade ' num2str(j) ' in record ' num2str(k)...                   ' (' deblank(what_f_array(k,:)) ')'])             break;          end       end       % collect stats       sampl_cross(j,k) = sacv_on(j)-offset(j);       time_cross(j,k) = 1000 * offset(j)/samp_f_mat(k);   end %for j   good_pts = find(time_cross(:,k) < 100000);   % strip out the NaNs   if good_pts ~= []      avg_cross(k)    = mean( time_cross(good_pts, k) );      avg_cross_total = mean(avg_cross);      med_cross(k)    = median( time_cross(good_pts, k) );      med_cross_total = mean(med_cross);      big_hist        = [big_hist' time_cross(good_pts, k)']';   endenddisp( ['Average crossing time: ' num2str(avg_cross_total)] )disp( ['Median crossing time: '  num2str(med_cross_total)] )[s_numb, s_bins] = hist(big_hist, 100);bar(s_bins, s_numb)title(['Average time at crossing -- ' num2str(avg_cross_total) 'msec'])orient landscapexlabel('Time of crossing slip radius (msec before saccade)')ylabel('Number of occurrences')orient landscapeif ~exist('export') export = 0; endif export   expdir   s_numb = s_numb';   save s_numb.txt s_numb /ascii   s_bins = s_bins';   save s_bins.txt s_bins /asciiendif ~exist('debugme') debugme = 0; endif ~debugme   clear k j list_len sacv_on offset good_pts    clear big_hist sampl_cross  avg_cross avg_cross_total   clear med_cross med_cross_total time_cross   clear s_bins s_numbend